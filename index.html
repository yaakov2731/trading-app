<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√©todo 2 | Gap Reversal Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #09090b;
            --bg-secondary: #18181b;
            --bg-card: #1c1c1f;
            --bg-input: #0f0f10;
            --bg-hover: #27272a;
            --border: #27272a;
            --border-light: #3f3f46;
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent: #dc2626;
            --accent-light: #ef4444;
            --accent-glow: rgba(220, 38, 38, 0.25);
            --accent-dark: #991b1b;
            --green: #22c55e;
            --green-glow: rgba(34, 197, 94, 0.2);
            --yellow: #eab308;
            --blue: #3b82f6;
            --purple: #a855f7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            color: var(--accent);
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        h1 span {
            color: var(--accent);
        }

        .subtitle {
            color: var(--text-muted);
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .stats-banner {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .stat-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-value.highlight {
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 0.25rem;
        }

        .badge {
            display: inline-block;
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            background: var(--accent);
            color: white;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-left: 0.5rem;
            vertical-align: middle;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            position: relative;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        .card-title-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--accent);
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .input-group.full-width {
            grid-column: span 2;
        }

        label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        input, select {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.7rem 0.875rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.15s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        input::placeholder {
            color: var(--text-muted);
        }

        select {
            cursor: pointer;
        }

        select option {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn {
            font-family: 'Inter', sans-serif;
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            width: 100%;
            margin-top: 1.25rem;
        }

        .btn-primary:hover {
            background: var(--accent-light);
            box-shadow: 0 4px 20px var(--accent-glow);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .formula-box {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
        }

        .formula-box code {
            color: var(--accent-light);
            display: block;
            margin-bottom: 0.5rem;
        }

        .formula-box .note {
            color: var(--text-muted);
            font-size: 0.7rem;
        }

        .results-section {
            display: none;
        }

        .results-section.visible {
            display: block;
            animation: fadeIn 0.25s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .direction-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.25rem;
            border-radius: 6px;
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .direction-badge.long {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid var(--green);
            color: var(--green);
        }

        .direction-badge.short {
            background: rgba(220, 38, 38, 0.15);
            border: 1px solid var(--accent);
            color: var(--accent-light);
        }

        .meta-info {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
        }

        .meta-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.75rem;
            background: var(--bg-input);
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .meta-tag .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .vix-low .dot { background: var(--green); }
        .vix-normal .dot { background: var(--blue); }
        .vix-high .dot { background: var(--yellow); }
        .vix-extreme .dot { background: var(--accent); }

        .levels-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .level-card {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.875rem;
            position: relative;
            border-left: 3px solid var(--border);
        }

        .level-card.entry { border-left-color: var(--blue); }
        .level-card.tp1 { border-left-color: var(--green); }
        .level-card.tp2 { border-left-color: var(--green); }
        .level-card.tp3 { border-left-color: var(--purple); }
        .level-card.sl { border-left-color: var(--accent); }
        .level-card.range { border-left-color: var(--yellow); }

        .level-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .level-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .level-desc {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 3px;
            padding: 0.15rem 0.4rem;
            font-size: 0.55rem;
            color: var(--text-muted);
            cursor: pointer;
            opacity: 0;
            transition: all 0.15s;
            font-family: 'Inter', sans-serif;
        }

        .level-card:hover .copy-btn {
            opacity: 1;
        }

        .copy-btn:hover {
            color: var(--text-primary);
            border-color: var(--accent);
        }

        .filters-section {
            margin-top: 1.25rem;
            padding: 1rem;
            background: var(--bg-input);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .filters-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
        }

        .filter-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.8rem;
        }

        .filter-item:last-child {
            border-bottom: none;
        }

        .filter-name {
            color: var(--text-secondary);
        }

        .filter-status {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .filter-status.pass { color: var(--green); }
        .filter-status.fail { color: var(--accent); }
        .filter-status.warn { color: var(--yellow); }

        .alert {
            padding: 0.875rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-size: 0.8rem;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .alert-warning {
            background: rgba(234, 179, 8, 0.1);
            border: 1px solid rgba(234, 179, 8, 0.3);
            color: var(--yellow);
        }

        .alert-success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: var(--green);
        }

        .alert-danger {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.3);
            color: var(--accent-light);
        }

        .summary-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
            margin-top: 1.25rem;
        }

        .summary-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            text-align: center;
        }

        .summary-item-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .summary-item-value.profit { color: var(--green); }
        .summary-item-value.risk { color: var(--accent-light); }

        .summary-item-label {
            font-size: 0.6rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.25rem;
        }

        .checklist-card {
            margin-top: 1.5rem;
        }

        .checklist-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        @media (max-width: 768px) {
            .checklist-grid {
                grid-template-columns: 1fr;
            }
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.6rem 0.75rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .checklist-item:hover {
            border-color: var(--border-light);
            background: var(--bg-hover);
        }

        .checklist-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .checklist-item label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: none;
            letter-spacing: normal;
            cursor: pointer;
            line-height: 1.3;
        }

        .checklist-item.checked {
            border-color: var(--green);
            background: rgba(34, 197, 94, 0.05);
        }

        .checklist-item.checked label {
            color: var(--green);
        }

        .timeline-section {
            margin-top: 1.25rem;
            padding: 1rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .timeline-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
        }

        .timeline-step {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.4rem 0;
        }

        .step-time {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.65rem;
            color: var(--accent-light);
            min-width: 70px;
            font-weight: 500;
        }

        .step-content {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .checklist-counter {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-muted);
            padding: 0.25rem 0.5rem;
            background: var(--bg-input);
            border-radius: 4px;
        }

        .checklist-counter.ready {
            color: var(--green);
            background: rgba(34, 197, 94, 0.1);
        }

        footer {
            text-align: center;
            padding: 2rem 0;
            color: var(--text-muted);
            font-size: 0.75rem;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .version-tag {
            display: inline-block;
            font-size: 0.6rem;
            padding: 0.15rem 0.4rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-muted);
            border-radius: 3px;
            margin-left: 0.5rem;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-size: 0.7rem;
            text-align: left;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.2s;
            border: 1px solid var(--border);
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            background: var(--border);
            border-radius: 50%;
            font-size: 0.55rem;
            color: var(--text-muted);
            margin-left: 0.25rem;
            font-style: normal;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Trading System</div>
            <h1>M√©todo 2 <span>Calculator</span></h1>
            <p class="subtitle">Gap Reversal Strategy | Extremo Real + Rango Esperado</p>
            <div class="stats-banner">
                <div class="stat">
                    <div class="stat-value highlight">87.0%</div>
                    <div class="stat-label">Win Rate Backtested</div>
                </div>
                <div class="stat">
                    <div class="stat-value">7.08</div>
                    <div class="stat-label">Profit Factor</div>
                </div>
                <div class="stat">
                    <div class="stat-value">$25,097</div>
                    <div class="stat-label">P&L 3M (1 ct)</div>
                </div>
                <div class="stat">
                    <div class="stat-value">1:2.7</div>
                    <div class="stat-label">Risk/Reward</div>
                </div>
            </div>
        </header>

        <div class="main-grid">
            <!-- Input Section -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="card-title-icon">üìä</span>
                        Datos de Entrada
                    </h2>
                    <span class="badge">Optimizado</span>
                </div>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label for="prevHigh">High Anterior</label>
                        <input type="number" id="prevHigh" placeholder="6100.00" step="0.25">
                    </div>
                    <div class="input-group">
                        <label for="prevLow">Low Anterior</label>
                        <input type="number" id="prevLow" placeholder="6050.00" step="0.25">
                    </div>
                    <div class="input-group">
                        <label for="prevClose">Close Anterior</label>
                        <input type="number" id="prevClose" placeholder="6080.00" step="0.25">
                    </div>
                    <div class="input-group">
                        <label for="todayOpen">Open Hoy</label>
                        <input type="number" id="todayOpen" placeholder="6095.00" step="0.25">
                    </div>
                    <div class="input-group">
                        <label for="extremeReal">
                            Extremo Real
                            <span class="tooltip">
                                <i class="info-icon">?</i>
                                <span class="tooltip-text">High o Low formado despu√©s de 1-1.5h de apertura. Esperar consolidaci√≥n de 15+ min para confirmar.</span>
                            </span>
                        </label>
                        <input type="number" id="extremeReal" placeholder="Opcional" step="0.25">
                    </div>
                    <div class="input-group">
                        <label for="vixLevel">Nivel VIX</label>
                        <select id="vixLevel">
                            <option value="low">VIX &lt; 15 (Baja)</option>
                            <option value="normal" selected>VIX 15-20 (Normal)</option>
                            <option value="high">VIX 20-25 (Alta)</option>
                            <option value="extreme">VIX &gt; 25 (Extrema)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="entryMode">
                            Modo Entry
                            <span class="tooltip">
                                <i class="info-icon">?</i>
                                <span class="tooltip-text">Agresivo: 15% (Gap DOWN). Est√°ndar: 18%. Conservador: 22% (Gap UP con baja confianza).</span>
                            </span>
                        </label>
                        <select id="entryMode">
                            <option value="aggressive">Agresivo (15%) - Gap DOWN</option>
                            <option value="standard" selected>Est√°ndar (18%)</option>
                            <option value="conservative">Conservador (22%) - Gap UP</option>
                        </select>
                    </div>
                    <div class="input-group full-width">
                        <label for="instrument">Instrumento</label>
                        <select id="instrument">
                            <option value="ES" selected>/ES - E-mini S&P 500 ($50/pt)</option>
                            <option value="MES">/MES - Micro E-mini S&P ($5/pt)</option>
                            <option value="NQ">/NQ - E-mini Nasdaq ($20/pt)</option>
                            <option value="GC">/GC - Gold ($100/pt)</option>
                        </select>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="calculateLevels()">
                    Calcular Niveles
                </button>

                <div class="formula-box">
                    <code>Rango = (Rango Anterior √ó Factor) + |Gap|</code>
                    <span class="note">Factor VIX: 0.82 (bajo) | 0.87 (normal) | 0.92 (alto) | 0.97 (extremo)</span>
                </div>
            </div>

            <!-- Results Section -->
            <div class="card results-section" id="resultsSection">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="card-title-icon">üéØ</span>
                        Niveles Operativos
                    </h2>
                </div>

                <div id="directionBadge" class="direction-badge long">
                    <span>‚ñ≤</span> LONG
                </div>

                <div class="meta-info">
                    <div id="vixTag" class="meta-tag vix-normal">
                        <span class="dot"></span>
                        <span>Factor 0.87</span>
                    </div>
                    <div id="gapTag" class="meta-tag">
                        <span>Gap: --</span>
                    </div>
                    <div id="rangeTag" class="meta-tag">
                        <span>Rango: --</span>
                    </div>
                </div>

                <div class="levels-grid">
                    <div class="level-card entry">
                        <button class="copy-btn" onclick="copyLevel(event, 'entryLevel')">Copy</button>
                        <div class="level-label">Entry (18%)</div>
                        <div class="level-value" id="entryLevel">--</div>
                        <div class="level-desc">Confirmar reversi√≥n</div>
                    </div>
                    <div class="level-card sl">
                        <button class="copy-btn" onclick="copyLevel(event, 'slLevel')">Copy</button>
                        <div class="level-label">Stop Loss (12%)</div>
                        <div class="level-value" id="slLevel">--</div>
                        <div class="level-desc" id="slPoints">-- pts riesgo</div>
                    </div>
                    <div class="level-card tp1">
                        <button class="copy-btn" onclick="copyLevel(event, 'tp1Level')">Copy</button>
                        <div class="level-label">TP1 (50%) - Cerrar 50%</div>
                        <div class="level-value" id="tp1Level">--</div>
                        <div class="level-desc">Mover SL a BE</div>
                    </div>
                    <div class="level-card tp2">
                        <button class="copy-btn" onclick="copyLevel(event, 'tp2Level')">Copy</button>
                        <div class="level-label">TP2 (75%) - Cerrar 30%</div>
                        <div class="level-value" id="tp2Level">--</div>
                        <div class="level-desc">Trailing stop</div>
                    </div>
                    <div class="level-card tp3">
                        <button class="copy-btn" onclick="copyLevel(event, 'tp3Level')">Copy</button>
                        <div class="level-label">TP3 (90%) - Cerrar 20%</div>
                        <div class="level-value" id="tp3Level">--</div>
                        <div class="level-desc">Target final</div>
                    </div>
                    <div class="level-card range">
                        <div class="level-label">Rango Esperado</div>
                        <div class="level-value" id="expectedRange">--</div>
                        <div class="level-desc" id="rangeAccuracy">Reversi√≥n med: 91%</div>
                    </div>
                </div>

                <div class="filters-section">
                    <div class="filters-title">Verificaci√≥n de Filtros</div>
                    <div class="filter-item">
                        <span class="filter-name">Gap m√≠nimo ‚â• 0.15%</span>
                        <span class="filter-status" id="filterGap">--</span>
                    </div>
                    <div class="filter-item">
                        <span class="filter-name">Rango anterior ‚â• 25 pts</span>
                        <span class="filter-status" id="filterRange">--</span>
                    </div>
                    <div class="filter-item">
                        <span class="filter-name">Tipo de Gap (DOWN preferido)</span>
                        <span class="filter-status" id="filterGapType">--</span>
                    </div>
                    <div class="filter-item">
                        <span class="filter-name">Extremo Real identificado</span>
                        <span class="filter-status" id="filterExtreme">--</span>
                    </div>
                </div>

                <div id="filterAlert"></div>

                <div class="summary-card">
                    <div class="summary-title">Resumen de Operaci√≥n</div>
                    <div class="summary-grid">
                        <div>
                            <div class="summary-item-value profit" id="potentialProfit">--</div>
                            <div class="summary-item-label">Profit Potencial</div>
                        </div>
                        <div>
                            <div class="summary-item-value risk" id="riskAmount">--</div>
                            <div class="summary-item-label">Riesgo M√°ximo</div>
                        </div>
                        <div>
                            <div class="summary-item-value" id="rrRatio">--</div>
                            <div class="summary-item-label">Risk/Reward</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Checklist Section -->
        <div class="card checklist-card">
            <div class="card-header">
                <h2 class="card-title">
                    <span class="card-title-icon">‚úì</span>
                    Checklist Extremo Real
                </h2>
                <span class="checklist-counter" id="checklistCounter">0/4</span>
            </div>
            
            <p style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 1rem;">
                Confirmar m√≠nimo 3 de 4 criterios antes de ejecutar entrada:
            </p>
            
            <div class="checklist-grid">
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check1">
                    <label for="check1">Consolidaci√≥n m√≠nima 15 min en el nivel extremo</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check2">
                    <label for="check2">Rechazo visible: mecha > 50% del cuerpo de vela</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check3">
                    <label for="check3">Volumen decreciente hacia el extremo (agotamiento)</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check4">
                    <label for="check4">Delta divergente / absorci√≥n institucional visible</label>
                </div>
            </div>

            <div class="timeline-section">
                <div class="timeline-title">Timeline de Ejecuci√≥n (ET)</div>
                <div class="timeline-step">
                    <span class="step-time">Noche ant.</span>
                    <span class="step-content">Registrar H/L/C del d√≠a</span>
                </div>
                <div class="timeline-step">
                    <span class="step-time">09:30</span>
                    <span class="step-content">Calcular Gap y Rango Esperado</span>
                </div>
                <div class="timeline-step">
                    <span class="step-time">10:00-11:00</span>
                    <span class="step-content">Identificar Extremo Real + Validar Checklist (3/4 m√≠n)</span>
                </div>
                <div class="timeline-step">
                    <span class="step-time">11:00+</span>
                    <span class="step-content">Ejecutar entrada si todos los filtros OK</span>
                </div>
                <div class="timeline-step">
                    <span class="step-time">14:00</span>
                    <span class="step-content">Time-based exit si no alcanz√≥ TP1</span>
                </div>
            </div>
        </div>

        <footer>
            <p>M√©todo 2 Gap Reversal Calculator <span class="version-tag">v2.0</span></p>
            <p style="margin-top: 0.5rem;">
                Backtested Oct-Dic 2025 | 23 trades | 87% Win Rate
            </p>
        </footer>
    </div>

    <script>
        // Instrument multipliers
        const instruments = {
            'ES': { multiplier: 50, name: '/ES', tick: 0.25 },
            'MES': { multiplier: 5, name: '/MES', tick: 0.25 },
            'NQ': { multiplier: 20, name: '/NQ', tick: 0.25 },
            'GC': { multiplier: 100, name: '/GC', tick: 0.10 }
        };

        // VIX factors (optimized based on backtest)
        const vixFactors = {
            'low': 0.82,
            'normal': 0.87,
            'high': 0.92,
            'extreme': 0.97
        };

        // Entry modes based on analysis
        const entryModes = {
            'aggressive': { entry: 0.15, sl: 0.10, label: '15%' },   // Gap DOWN preferido
            'standard': { entry: 0.18, sl: 0.12, label: '18%' },     // Balance
            'conservative': { entry: 0.22, sl: 0.14, label: '22%' }  // Gap UP / menor confianza
        };

        // OPTIMIZED PARAMETERS based on real backtest analysis
        const params = {
            tp1Pct: 0.50,        // 50% - primer target
            tp2Pct: 0.75,        // 75% - segundo target
            tp3Pct: 0.90,        // 90% - target final (mediana de reversi√≥n)
            minGapPct: 0.15,     // 0.15% m√≠nimo
            minPrevRange: 25,    // 25 pts m√≠nimo
            gapMoveEstimate: 0.42 // 42% mediana real de mov. en dir gap
        };

        function calculateLevels() {
            const prevHigh = parseFloat(document.getElementById('prevHigh').value);
            const prevLow = parseFloat(document.getElementById('prevLow').value);
            const prevClose = parseFloat(document.getElementById('prevClose').value);
            const todayOpen = parseFloat(document.getElementById('todayOpen').value);
            const extremeReal = parseFloat(document.getElementById('extremeReal').value);
            const vixLevel = document.getElementById('vixLevel').value;
            const instrumentKey = document.getElementById('instrument').value;
            const entryModeKey = document.getElementById('entryMode').value;

            if (isNaN(prevHigh) || isNaN(prevLow) || isNaN(prevClose) || isNaN(todayOpen)) {
                alert('Complete los campos requeridos: High, Low, Close anterior y Open de hoy');
                return;
            }

            const instrument = instruments[instrumentKey];
            const entryMode = entryModes[entryModeKey];
            const prevRange = prevHigh - prevLow;
            const gap = todayOpen - prevClose;
            const gapPercent = (gap / prevClose) * 100;
            const isGapUp = gap > 0;
            const factor = vixFactors[vixLevel];
            const expectedRange = (prevRange * factor) + Math.abs(gap);
            const direction = isGapUp ? 'SHORT' : 'LONG';

            // Auto-suggest entry mode based on gap type
            if (isGapUp && entryModeKey === 'aggressive') {
                document.getElementById('entryMode').value = 'standard';
            } else if (!isGapUp && entryModeKey === 'conservative') {
                document.getElementById('entryMode').value = 'aggressive';
            }

            // Estimate extreme if not provided
            let baseExtreme = extremeReal;
            if (isNaN(extremeReal)) {
                const gapMove = expectedRange * params.gapMoveEstimate;
                baseExtreme = isGapUp ? todayOpen + gapMove : todayOpen - gapMove;
            }

            // Calculate levels with dynamic entry mode
            const entryPct = entryMode.entry;
            const slPct = entryMode.sl;
            
            let entry, tp1, tp2, tp3, sl;
            
            if (direction === 'SHORT') {
                entry = baseExtreme - (expectedRange * entryPct);
                sl = baseExtreme + (expectedRange * slPct);
                tp1 = baseExtreme - (expectedRange * params.tp1Pct);
                tp2 = baseExtreme - (expectedRange * params.tp2Pct);
                tp3 = baseExtreme - (expectedRange * params.tp3Pct);
            } else {
                entry = baseExtreme + (expectedRange * entryPct);
                sl = baseExtreme - (expectedRange * slPct);
                tp1 = baseExtreme + (expectedRange * params.tp1Pct);
                tp2 = baseExtreme + (expectedRange * params.tp2Pct);
                tp3 = baseExtreme + (expectedRange * params.tp3Pct);
            }

            const riskPoints = Math.abs(entry - sl);
            const rewardPoints = Math.abs(tp2 - entry);
            const rrRatio = rewardPoints / riskPoints;
            const riskDollars = riskPoints * instrument.multiplier;
            const rewardDollars = rewardPoints * instrument.multiplier;

            // Update UI
            document.getElementById('resultsSection').classList.add('visible');

            // Update entry label dynamically
            document.querySelector('.level-card.entry .level-label').textContent = `Entry (${entryMode.label})`;
            document.querySelector('.level-card.sl .level-label').textContent = `Stop Loss (${(slPct * 100).toFixed(0)}%)`;

            // Direction badge
            const badge = document.getElementById('directionBadge');
            badge.className = `direction-badge ${direction.toLowerCase()}`;
            badge.innerHTML = direction === 'LONG' 
                ? '<span>‚ñ≤</span> LONG' 
                : '<span>‚ñº</span> SHORT';

            // Meta tags
            const vixClasses = { 'low': 'vix-low', 'normal': 'vix-normal', 'high': 'vix-high', 'extreme': 'vix-extreme' };
            document.getElementById('vixTag').className = `meta-tag ${vixClasses[vixLevel]}`;
            document.getElementById('vixTag').innerHTML = `<span class="dot"></span><span>Factor ${factor}</span>`;
            document.getElementById('gapTag').innerHTML = `<span>Gap: ${gap >= 0 ? '+' : ''}${gap.toFixed(2)} (${gapPercent.toFixed(2)}%)</span>`;
            document.getElementById('rangeTag').innerHTML = `<span>Rango: ${expectedRange.toFixed(1)} pts</span>`;

            // Levels
            document.getElementById('entryLevel').textContent = entry.toFixed(2);
            document.getElementById('tp1Level').textContent = tp1.toFixed(2);
            document.getElementById('tp2Level').textContent = tp2.toFixed(2);
            document.getElementById('tp3Level').textContent = tp3.toFixed(2);
            document.getElementById('slLevel').textContent = sl.toFixed(2);
            document.getElementById('slPoints').textContent = `${riskPoints.toFixed(1)} pts ($${riskDollars.toFixed(0)})`;
            document.getElementById('expectedRange').textContent = `${expectedRange.toFixed(1)} pts`;

            // Summary
            document.getElementById('potentialProfit').textContent = `$${rewardDollars.toFixed(0)}`;
            document.getElementById('riskAmount').textContent = `$${riskDollars.toFixed(0)}`;
            document.getElementById('rrRatio').textContent = `1:${rrRatio.toFixed(2)}`;

            // Filters (STRICTER)
            const gapFilter = Math.abs(gapPercent) >= params.minGapPct;
            const rangeFilter = prevRange >= params.minPrevRange;
            const gapTypeFilter = !isGapUp; // Gap DOWN preferred (100% fill rate vs 64.7%)
            const extremeFilter = !isNaN(extremeReal);

            updateFilter('filterGap', gapFilter, `${Math.abs(gapPercent).toFixed(2)}%`);
            updateFilter('filterRange', rangeFilter, `${prevRange.toFixed(0)} pts`);
            updateFilter('filterGapType', gapTypeFilter, isGapUp ? 'UP (64% fill)' : 'DOWN (100% fill)', gapTypeFilter ? 'pass' : 'warn');
            updateFilter('filterExtreme', extremeFilter, extremeFilter ? '‚úì Definido' : 'Pendiente', extremeFilter ? 'pass' : 'warn');

            // Alert
            const alertDiv = document.getElementById('filterAlert');
            const criticalPass = gapFilter && rangeFilter;
            
            if (!criticalPass) {
                alertDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <span>‚õî</span>
                        <div><strong>Filtros cr√≠ticos no cumplidos.</strong> Este d√≠a no cumple criterios m√≠nimos. NO OPERAR.</div>
                    </div>`;
            } else if (isGapUp) {
                alertDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <span>‚ö†Ô∏è</span>
                        <div><strong>Gap UP detectado.</strong> Fill rate hist√≥rico: 64.7%. Considerar reducir tama√±o de posici√≥n o skip.</div>
                    </div>`;
            } else if (!extremeFilter) {
                alertDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <span>‚è≥</span>
                        <div><strong>Esperando Extremo Real.</strong> Monitorear 10:00-11:00 ET. Completar checklist antes de entrar.</div>
                    </div>`;
            } else {
                alertDiv.innerHTML = `
                    <div class="alert alert-success">
                        <span>‚úÖ</span>
                        <div><strong>Setup v√°lido.</strong> Gap DOWN + filtros OK. Verificar checklist 3/4 antes de ejecutar.</div>
                    </div>`;
            }
        }

        function updateFilter(elementId, passed, value, forceClass = null) {
            const el = document.getElementById(elementId);
            const statusClass = forceClass || (passed ? 'pass' : 'fail');
            el.className = `filter-status ${statusClass}`;
            const icon = statusClass === 'pass' ? '‚úì' : (statusClass === 'warn' ? '‚ö†' : '‚úó');
            el.innerHTML = `${icon} ${value}`;
        }

        function copyLevel(event, elementId) {
            const value = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(value).then(() => {
                const btn = event.target;
                btn.textContent = '‚úì';
                setTimeout(() => btn.textContent = 'Copy', 800);
            }).catch((err) => {
                console.error('Failed to copy to clipboard:', err);
                const btn = event.target;
                btn.textContent = '‚úó';
                setTimeout(() => btn.textContent = 'Copy', 800);
            });
        }

        function toggleCheck(item) {
            const checkbox = item.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            item.classList.toggle('checked', checkbox.checked);
            updateChecklistCounter();
        }

        function updateChecklistCounter() {
            const checks = document.querySelectorAll('.checklist-item input[type="checkbox"]:checked').length;
            const counter = document.getElementById('checklistCounter');
            counter.textContent = `${checks}/4`;
            counter.classList.toggle('ready', checks >= 3);
        }

        // Event listeners
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') calculateLevels();
            });
        });

        document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach(cb => {
            cb.addEventListener('change', updateChecklistCounter);
        });
    </script>
</body>
</html>
